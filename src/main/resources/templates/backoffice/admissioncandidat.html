<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${title}"></title>
<link rel="stylesheet" type="text/css"
	href="../static/css/bootstrap.min.css"
	th:href="@{/css/bootstrap.min.css}" />
</head>
<body>
	<div class="container-fluid">
		<div class="row flex-nowrap">
			<div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark">
				<div
					class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100">
					<a href="/"
						class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none">
						<span class="fs-5 d-none d-sm-inline">Menu</span>
					</a>
					<ul
						class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start"
						id="menu">
						<li class="nav-item"><a href="#"
							class="nav-link align-middle px-0"> <i class="fs-4 bi-house"></i>
								<span class="ms-1 d-none d-sm-inline">Home</span>
						</a></li>
						<li><a href="#submenu1" data-bs-toggle="collapse"
							class="nav-link px-0 align-middle"> <i
								class="fs-4 bi-speedometer2"></i> <span
								class="ms-1 d-none d-sm-inline">Dashboard</span>
						</a>
							<ul class="collapse show nav flex-column ms-1" id="submenu1"
								data-bs-parent="#menu">
								<li class="w-100"><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Item</span> 1
								</a></li>
								<li><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Item</span> 2
								</a></li>
							</ul></li>
						<li><a href="#" class="nav-link px-0 align-middle"> <i
								class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Orders</span></a>
						</li>
						<li><a href="#submenu2" data-bs-toggle="collapse"
							class="nav-link px-0 align-middle "> <i
								class="fs-4 bi-bootstrap"></i> <span
								class="ms-1 d-none d-sm-inline">Bootstrap</span></a>
							<ul class="collapse nav flex-column ms-1" id="submenu2"
								data-bs-parent="#menu">
								<li class="w-100"><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Item</span> 1
								</a></li>
								<li><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Item</span> 2
								</a></li>
							</ul></li>
						<li><a href="#submenu3" data-bs-toggle="collapse"
							class="nav-link px-0 align-middle"> <i class="fs-4 bi-grid"></i>
								<span class="ms-1 d-none d-sm-inline">Products</span>
						</a>
							<ul class="collapse nav flex-column ms-1" id="submenu3"
								data-bs-parent="#menu">
								<li class="w-100"><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Product</span> 1
								</a></li>
								<li><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Product</span> 2
								</a></li>
								<li><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Product</span> 3
								</a></li>
								<li><a href="#" class="nav-link px-0"> <span
										class="d-none d-sm-inline">Product</span> 4
								</a></li>
							</ul></li>
						<li><a href="#" class="nav-link px-0 align-middle"> <i
								class="fs-4 bi-people"></i> <span
								class="ms-1 d-none d-sm-inline">Customers</span>
						</a></li>
					</ul>
					<hr>
					<div class="dropdown pb-4">
						<a href="#"
							class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
							id="dropdownUser1" data-bs-toggle="dropdown"
							aria-expanded="false"> <img src="https://github.com/mdo.png"
							alt="hugenerd" width="30" height="30" class="rounded-circle">
							<span class="d-none d-sm-inline mx-1">loser</span>
						</a>
						<ul class="dropdown-menu dropdown-menu-dark text-small shadow">
							<li><a class="dropdown-item" href="#">New project...</a></li>
							<li><a class="dropdown-item" href="#">Settings</a></li>
							<li><a class="dropdown-item" href="#">Profile</a></li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li><a class="dropdown-item" href="#">Sign out</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="col py-3">
				<div class="container">
					<div>
						<span th:text="${errormessage}" th:class="${alertClass}"></span>
					</div>
					<div class="ps-5 pt-5">
						<form th:action="@{/admin/getAllCandidatures}" method="get">
							<input type="text" name="numeroRef"
								placeholder="Numéro de reférence">
							<button class="btn btn-primary" type="submit">Cherchez</button>
						</form>
					</div>
					<div>
						<span th:text="${messageOk}" th:class="${alertClass}"></span> <span
							th:text="${messageErreur}" th:class="${alertClass}"></span>
					</div>
					<div class="p-5">
						<form th:action="@{/update/candidature}" method="post">
							<!--<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
							<table class="table">
								<thead>
									<tr>
										<th scope="col">Réference</th>
										<th scope="col">Prénom</th>
										<th scope="col">Nom</th>
										<th scope="col">Crée le</th>
										<th scope="col">Status</th>
										<th scope="col">Actions</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="candidature:${candidats}">
										<th th:text="${candidature.numeroRef}"></th>
										<th th:text="${candidature.candidat.prenom}"></th>
										<th th:text="${candidature.candidat.nom}"></th>
										<td th:text="${candidature.jourDeCandidature}"></td>
										<td><input type="hidden" name="id"
											th:value="${candidature.idCandidature}"> <select
											class="form-select form-select-lg mb-3 status"
											aria-label=".form-select-lg example" name="libelle">
												<option value=""></option>
												<option value="En cours de traitement">En cours de
													traitement</option>
												<option value="En instruction">En instruction</option>
												<option value="Refusé">Refusé</option>
												<option value="Admis">Admis</option>
										</select></td>
										<td><a class="btn btn-primary"
											th:href="@{/admin/consulter/candidature/{id}(id=${candidature.candidat.idPersonne})}">
												Consulter </a> <input type="submit" value="Modifier"
											class="btn btn-success"> <a class="btn btn-danger"
											href="#"> Supprimer </a></td>
									</tr>
								</tbody>
							</table>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--  C'est pour recupérer le csrf token generer par le serveur  
										<meta th:name="_csrf" th:content="${_csrf.token}"/>
										<meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
										th:attr="data-id=${candidature.idCandidature}"-->
	<script>
		//let status = document.querySelector(".status")
		//console.log(status)
		//status.addEventListener('change', (event) => {
		//	event.preventDefault();
		//	console.log(event.target.value)
		//	console.log(event.target.dataset.id)
		//let body = {
		//	    id: event.target.dataset.id,
		//	    status: event.target.value    
		//	} 
		//var token = document.querySelector("meta[name='_csrf']").getAttribute("content");
		// var header = document.querySelector("meta[name='_csrf_header']").getAttribute("content");
		// console.log(token)
		//   console.log("------")
		// console.log(header)
		//	fetch('http://localhost:8080/admin/update/candidature', {
		//		  method: 'POST',
		//		  headers: {
		//		    accept: 'application.json',
		//		    'Content-Type': 'application/json',
		//		  },
		//		  body: JSON.stringify({
		//		    id: event.target.dataset.id,
		//		    status: event.target.value    
		//		  })
		//		})
		//	.then(function(response){ 
		//	return response.json()
		//	})
		//	.then(function(data){
		//	console.log(data)
		//	})	
		//})
	</script>
</body>
</html>